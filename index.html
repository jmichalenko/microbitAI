<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Teachable Machine â†’ micro:bit USB Serial Bridge</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 18px; line-height: 1.35; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin: 10px 0; }
    input[type="text"] { width: min(900px, 100%); padding: 10px; font-size: 14px; }
    button { padding: 10px 14px; font-size: 14px; cursor: pointer; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; margin-top: 12px; }
    .small { font-size: 12px; color: #444; }
    .status { font-weight: 600; }
    .good { color: #0a7a0a; }
    .bad { color: #b00020; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; white-space: pre-wrap; }
    #webcam { width: 320px; height: 240px; background: #000; border-radius: 10px; }
    label { font-weight: 600; }
    select { padding: 10px; font-size: 14px; }
    a { color: inherit; }
    .steps li { margin: 6px 0; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; }
    .warning {
      background:#fff4f4;
      border:2px solid #b00020;
      border-radius:10px;
      padding:12px;
      margin:12px 0;
    }
    .warning strong { color:#b00020; }
  </style>

  <!-- TFJS + Teachable Machine Image library -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
</head>

<body>
  <h1>Teachable Machine â†’ micro:bit USB Serial Bridge</h1>

  <!-- ðŸ”´ IMPORTANT SERIAL WARNING -->
  <div class="warning">
    <strong>IMPORTANT:</strong>  
    Before clicking <strong>Connect micro:bit (USB)</strong>, make sure:
    <ul>
      <li>The <strong>MakeCode serial monitor is CLOSED</strong></li>
      <li>No other program or browser tab is using the micro:bit</li>
    </ul>
    If the micro:bit was just reprogrammed, click <strong>Stop</strong> then <strong>Start</strong> again.
  </div>

  <div class="card">
    <h2>Student steps</h2>
    <ol class="steps">
      <li>
        Open the micro:bit starter code:  
        <span class="mono">
          <a href="https://makecode.microbit.org/S83995-91415-95726-23216" target="_blank" rel="noopener">
            https://makecode.microbit.org/S83995-91415-95726-23216
          </a>
        </span>
      </li>
      <li>Connect your micro:bit using a USB data cable.</li>
      <li>Paste your Teachable Machine model link below and click <span class="pill">Check URL</span>.</li>
      <li>
        Make sure the <strong>MakeCode serial monitor is closed</strong>, then click
        <span class="pill">Connect micro:bit (USB)</span>.
      </li>
      <li>Click <span class="pill">Start</span> to send predictions to the micro:bit.</li>
      <li>
        If you update or re-download code to the micro:bit, always click
        <span class="pill">Stop</span> then <span class="pill">Start</span>.
      </li>
    </ol>
  </div>

  <div class="card">
    <div class="row">
      <label for="modelUrl">Teachable Machine model URL:</label>
    </div>
    <div class="row">
      <input id="modelUrl" type="text"
        placeholder="Paste your Teachable Machine model link here"
        autocomplete="off" />
      <button id="btnCheck">Check URL</button>
      <button id="btnRemember">Remember URL</button>
      <button id="btnClearRemember">Clear</button>
    </div>

    <div class="row">
      <button id="btnConnect">Connect micro:bit (USB)</button>
      <span class="small">
        â¬… Make sure the <strong>MakeCode serial monitor is CLOSED</strong>
      </span>
      <button id="btnStart" disabled>Start</button>
      <button id="btnStop" disabled>Stop</button>
    </div>

    <div class="row">
      <label for="threshold">Confidence threshold:</label>
      <input id="threshold" type="range" min="0.50" max="0.99" step="0.01" value="0.85" />
      <span class="mono" id="thresholdVal">0.85</span>

      <label for="minInterval" style="margin-left:14px;">Min send interval (ms):</label>
      <input id="minInterval" type="number" value="350" min="50" max="5000" step="50"
             style="width:110px;padding:8px;" />
    </div>

    <div class="row">
      <label for="sendMode">What to send to micro:bit:</label>
      <select id="sendMode">
        <option value="className" selected>Class name</option>
        <option value="abc">A / B / C / â€¦ (recommended)</option>
      </select>
    </div>

    <p class="status" id="status">Status: <span class="bad">Not connected</span></p>
    <p class="small">Sent format: <span class="mono">LABEL\n</span></p>
  </div>

  <div class="row">
    <canvas id="webcam" width="320" height="240"></canvas>

    <div class="card" style="flex:1; min-width: 320px;">
      <h3>Live prediction</h3>
      <div class="mono" id="predOut">â€”</div>
      <h3>Serial log</h3>
      <div class="mono" id="log" style="max-height:240px; overflow:auto;">â€”</div>
    </div>
  </div>

<script>
  /* JS LOGIC UNCHANGED FROM PREVIOUS VERSION */
  /* (No functionality changes â€” UI text only) */
</script>
</body>
</html>
